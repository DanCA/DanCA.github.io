<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Flor Progresiva</title>
    <style>
        body { background:black; display:flex; justify-content:center; }
        canvas { border:1px solid #444; background:black; }
    </style>
</head>
<body>

<canvas id="canvas" width="800" height="800"></canvas>

<script>
async function drawFromJSON(jsonURL) {
    const response = await fetch(jsonURL);
    const regions = await response.json();

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    ctx.translate(canvas.width / 2, canvas.height / 2);

    // Obtener límites
    let allPoints = regions.flatMap(r => r.contour);
    let xs = allPoints.map(p => p[0]);
    let ys = allPoints.map(p => p[1]);

    let minX = Math.min(...xs), maxX = Math.max(...xs);
    let minY = Math.min(...ys), maxY = Math.max(...ys);

    let width = maxX - minX;
    let height = maxY - minY;

    let scale = Math.min(600 / width, 600 / height);
    let centerX = (minX + maxX) / 2;
    let centerY = (minY + maxY) / 2;

    // Dibujo progresivo
    let index = 0;

    function drawNextRegion() {
        if (index >= regions.length) return; // Fin del dibujo

        let region = regions[index];
        let pts = region.contour;

        ctx.fillStyle = `rgb(${region.color[0]},${region.color[1]},${region.color[2]})`;

        ctx.beginPath();
        ctx.moveTo((pts[0][0] - centerX) * scale,
                   -(pts[0][1] - centerY) * scale);

        for (let i = 1; i < pts.length; i++) {
            ctx.lineTo((pts[i][0] - centerX) * scale,
                       -(pts[i][1] - centerY) * scale);
        }

        ctx.closePath();
        ctx.fill();

        index++;
        requestAnimationFrame(drawNextRegion); // dibuja el siguiente pétalo
    }

    drawNextRegion(); // iniciar animación
}

// Cargar tu JSON
drawFromJSON("rosas.json");
</script>

</body>
</html>
